## 常见约束

### 含义

*   一种限制，用于限制表中的数据，为了保证表中数据的准确和可靠性

### 关键词分类

* not null :非空，用于保证该字段的值不能为空
* default  :默认，用于保证该字段有默认值
* primary key  : 主键，用于保证该字段的值有唯一性，并且非空，起名字没效果，还是primary
* unique : 唯一，用于保证该字段具有唯一性。可以为空
* check : 检查约束（mysql不支持，使用不报错）
* foreing key :外键，用于限制两个表的关系，用于保证该字段的值必须来自主表的关联列的值。在从表添加外键约束，用于引用主表某列的值



### 添加分类

|                | 列级约束                                         | 表级约束                   |
| -------------- | ------------------------------------------------ | -------------------------- |
| 位置           | 列的后面                                         | 所有列的下面               |
| 支持的约束类型 | 语法上都支持，但是外键约束没有效果               | 除了非空、默认，其他都支持 |
| 起约束名       | 不可以                                           | 可以，对主键无效           |
| 使用           | 一个字段可以追加多个，中间用空格断开，无顺序要求 |                            |

### 添加

* 创建表时
* 修改表时

### 添加例子

*   创建表添加约束

    ```mysql
    create database students; #创建数据库
    use stedents;#使用数据库
    create table stuinfo(
    	id int primary key,#设置列级约束主键,
        stuName varchar(20) not null #设置列级约束 非空
        gender char(1) check(gender='男' or gender='女') #设计列级约束检查
        age int default 18 #设置列级约束默认
        majorId int foreign key references major(id) #列级约束外键，但是不支持（5.7版本后认为foreign key 错误语法）
        
    #表级约束语法
    #[constraint 约束名] 约束类型（字段名），约束名不能重复
        
    constraint pk primary key(id)#设置表级主键
    constraint up unique(seat) #设置表级唯一键
    constraint ck check(gender='男'or gender='女')#设置表级检查
    constraint fk_stuinfo_major foreign key(majorid) references major(id)#表级外键 
    ```

*   修改表时添加约束

    ```mysql
    #1.添加列级约束
    alter table 表名 modify column 字段名 字段类型 新约束
    #添加表级约束
    alter table 表名 add [constraint 约束名] 约束类型（字段名） [外键的引用]
    
    #1.添加非空约束
    alter table stuinfo modify column stuname varchar(20) not null
    #2.添加默认约束
    alter table stuinfo modify column age int default 18
    #3.添加主键
    	# 列级约束
    	alter table stuinfo modify column id int primary key;
    	#表级约束
    	1.alter table stuinfo modify column key(id);
    	2.alter table stuinfo add constraint 添加约束的列，起的名字(别名) primary key(需要添加约束的列)
    	
    #4.添加唯一
    	#1.列级约束
    	alter table stuinfo modify column seat int unique;
    	#2.表级约束
    	alter table stuinfo add unique(seat);
    #5.添加外键
    alter table stuinfo add foreign key(majorid) references major(id)
    （#向表stuinfo添加列dept_id,并在其中定义foreign key 约束，与之相关联的列是stu表中的id列
    alter table stuinfo add constraint fk_stuinfo_stu foreign key(dept_id) references stu(id)
    #主要是注意那个表，用谁的列，应该用在那个关键词后边）	
    ```

*   修改表删除约束

    ```mysql
    #1.删除非空约束
    alter table stuinfo modify column stuname varchar(20)  null
    #2.删除默认约束
    alter table stuinfo modify column age int
    #3.删除主键
    	# 列级约束
    	alter table stuinfo drop primary key;
    #4.删除唯一
    	#1.列级约束
    	alter table stuinfo drop index 唯一键名；
    #5.删除外键
    alter table stuinfo drop foreign key 外键约束名
    ```

## 主键

*   与唯一区别

    

    |      | 唯一性 | 是否为空 | 一个表有几个 | 是否可以组合   |
    | ---- | ------ | -------- | ------------ | -------------- |
    | 主键 | √      | ×        | 至多1个      | 可以，但不推荐 |
    | 唯一 | √      | √        | 可以有多个   | 可以，但不推荐 |

## 外键

### 介绍

*   用于限制两个表的关系，从表的字段值引用了主表的某字段值

* 要求在从表设置外键关系

* 从表的外键列表的类型和主表的关联列（被引用列）的类型要求一致或者兼容，名称无要求

    * 主表的关联列（被引用列 ）必须是以key(一般是主键或者唯一键)

* 插入数据时，先插入主表，在插入从表

    删除数据，先删除从表，在删除主表



### 删除

```mysql
#删除主表数据
#方式一：级联删除
外键添加子句 on delete cascade;
方式二：级联置空
外键添加子句 on delete set null

# ??

2. 可以加入的数目

    可以加入数目不限制，顺序也不限制。
```



