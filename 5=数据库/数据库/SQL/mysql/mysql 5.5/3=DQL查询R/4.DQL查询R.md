## DQL语言学习

[toc]

## 介绍

*   进行数据库访问的时候，必须要先打开指定库基础

    ```mysql
    执行顺序
    7		select 查询条件	   			# 的 后面的
    1		from 表                	   #   主体   
    2		[join type] join 表2
	3		on 连接条件
    4		where 筛选条件				# 的 前面的
    5		group by 分组字段
    6		having 分组后的筛选
    8		order by 排序的字段
    9		limit 起始条件索引，要显示的条目个数（显示的行数），  
    #索引从0开始，0可以省略不写
    #要显示的页数page,每页显示的条目数size limit （page-1*size size）
    ```
    
    

## 1. 基础查询

```mysql
select 查询列表 from 表名
select 查询列表 as 别名 from 表名
select distinct 查询列表 as 别名 from 表名 as 别名

# 查询的结果集，是一个虚拟表

# 查询列表
	表中字段、常量值、表达式、函数(这个就是挑选显示在虚拟表中的)
	可由多个部分组成，中间用逗号隔开
	
# as
	其起名
# distinct
	去重
	删除筛选出来的查询列表的重复值
	查询列表是多个字段的时候，不会报错，但是不同人貌似运行出来不一样，这个需要自己尝试
```

### 查询列表

*   字段

    *   多个字段

        ```mysql
        # 逗号隔开 ： 字段名，字段名
        1. select 字段名，字段名 from 表名；
        2. 直接使用 select 字段 ，就可以查找到具体字段
        3. 字段过多
        	就让关键字单独成处一行，字段单独一行，然后用 F12 格式化（sqlyog）
        4. 进行拼接
        	比如  select xing+ming as "姓名" #就会将两个字段 xing 和 ming 拼接成一个新的字段 ：姓名
        ```

    *   表中所有的字段

        ```mysql
        # 1.
        直接双击要进行查询的字段，就可以直接出现在 select 后面了,(是反引号引着的 ``）记得加逗号
         
        
        # 2.
        使用 * 代表所有的字段，但是是按照默认的顺序查询的，不能自己决定顺序
        ```

*   常量值

    ```mysql
    # 1. 字符型和日期型的 :单引号引起来
    	select 'john'
    # 2. 数值型不需要
    	select 100
    ```

*   表达式

    ```mys
    select 100%98;
    ```

*   函数

    ```go
    select version();    #调用函数执行的返回值
    ```

### 起别名

*   如果查询的字段有重名的情况，使用别名可以区别开来

*   起别名后，查询出来的结果就用别名显示了

    ```mysql
    # 1.单个值起别名
           select 查询列表 as 别名 from 表名；
           执行结果显示就以别名的形式展示出来
    # 2.多个值起别名
       	select 查询列表 as 别名，查询列表 别名，...，from 表名; 
       	
    # 3 空格替代 as	
       可以直接使用空格代替as，但是数量太多了，就不要用了，容易混淆
       
    # 4 含有特殊字符
       别名中含有特殊字符的，使用双引号引起来，当值出现歧义
    
    # 5.别名可以用 双引号 、 单引号 、什么也不加
       
    ```
### + 号作用

```mysql
# mysql 中只有一个作用——运算符

1.两个操作数都是数值型，则进行加法运算
		select 100+90;
		
2.一个操作数是数值型，一个是字符型，则会试图转换字符型到数值型
	如果成功，则执行加法运算
	select '100'+90;
	如果失败，则将字符型数值转化为 0
	
3.一方为 null,结果肯定是 null
	select null+0;
```

### 拼接

```mysql
select contact(字段1,字段2，...)[as 别名]   #常搭配起别名一起使用
	字段可以是字段，可以是其他的类型符号
	注意字段中有一个是 null ,拼接出来的就是 null ,注意使用 ifnull
```

### null

```mysql
# 特别注意null这个项

ifnull(值为null的字段或表达式，替换null的值)  #是null返回指定的值，不是null,返回自身值
	
	null +/and 另一个值，结果就是null
```

### 查找索引

```mysql
show index from stuinfo # 查询列表的所有索引
```

### 常用技巧

```mysql
1. 查看表结构
	desc 表名;
	show columns from employees;
```



## 2. 条件查询

```mysql
3.    select 查询列表 
1.    from 表名
2.    where 筛选条件；
# 选出表中符合筛选条件的查询列表

```

### 1.条件为函数

```mysql
select 函数名字(实参列表) [from 表名]


特点：
	叫什么：函数名
	做什么：函数功能
函数分类
    单行函数：
    分组函数：
		 又叫统计函数、聚合函数、组函数
		 统计使用
```



### 2.按条件运算

```mysql
# 条件运算符  
	> < =   >=  <=
	<> !=    都是不等于，不建议使用 !=
1.查询列表可以是多个，同时筛选条件可以是一个或者多个
2. 
	= 		只能判断普通内容
	is		只能判断null
	<=>		安全等于，即能判断普通内容也能判断 null （不常用）
	 
```

### 2.逻辑运算

```mysql
# 逻辑运算符  
	&&  	||  	！  
	and  	or   	not  # 不建议使用

# 1. 用于连接条件表达式

select  name,salary from employees where salary>100 and salary<900;
选出 name 和 salary 中salary>100 and salary<900的

# 2. &&  和   and  :与，两个条件均为true，结果为true

||   和   or     :或，两条件一个为真，则结果为真

！    和   not  :非，输出相反结果，本身为true,结果为false;本身为false,结果为true
```



### 3.模糊查询

*   like 

    ```mysql
    name like '%a%';   # 选出  包含 任意个 a 的 name,其前后都是任意个字符
    name not like '%a%'
    1.通常和通配符联合使用，对字符型数据进行部分匹配查询
    2.可以搭配出来 开头、结尾、某个位置的字符
    ```

    

*   between and 

    ```mysql
    id  between 100 and 30 ；
    id not between 100 and 30 ；
    
    1.包含两边的值，区间是[30,100],
    
    2.两个值放置顺序顺序固定，左大右小
    
    3.两个值类型要一致
    ```

*   in 

    ```mysql
    id in ('IT','AD')  # 选出 id 中为 IT 、AD 的
    id not in ('IT','AD')
    1.判断某字段的值是否属于in列表中的某一项（可以理解为 =）
    2.提高语句简洁度
    3.不支持通配符
    ```

*   is null  和 is not nul

    ```mysql
    salar is null;  #选出工资是零的
    
    1.= 或 <>  不能用于判断 null
    2.is null 和 is not null 仅可以判断 null
    3.安全等于   <=>  （就是 ==,判断是否等于） ，可以判断null，也可以判断其他值
    
    salary <=> null;
    salary <=> 1200;
    ```

## 3.排序查询

```mysql
select 查询列表 
from 表 
[where 筛选条件]
order by 排序列表/字段  asc|desc

1.  asc  升序    默认：升序
	desc 降序 
2. 排序列表：单个字段、多个字段、表达式、函数、别名，一般在最后，limit字句除外
3. 多个字段排序规则，类似多级关键词

order by  salary asc , employee_id desc; #先按照salary排序，然后按照emplyee_id排序
```

## 4.分组函数

```mysql
select 分组函数,分组列表1，分组列表2 from  表名
group by 分组列表1，分组列表2 //将两个列表（分组字段）都一样的合并到一组，多个字段没有顺序要求
[having 分组后的筛选]

#-------------------------------------------------------

注意：
1.要求查询列表特殊，要求是分组函数和group by后出现的字段
2.having 和 group by 后面很少用别名，麻烦
3.记住最后加分号，
4.分组查询分为两类：分组前筛选、分组后筛选
            数据源          位置                关键词
  分组前筛选：原始表         group by子句前面     where
  分组后筛选：分组后的结果表  group by子句后面      having
  
  分组函数做条件，肯定是在 having 中
```

*   例子

    ```mysql
    例子：
    按照员工姓名的长度分组，查询每一组的员工个数，筛选员工个数>5的有哪些
    
    select count(*) length(last_name) len_name
    from employees
    group by len_name
    having count>5;
    
    思路：
    1.尽快读懂题意的方法就是把那个表格的表头画出来，都需要显示什么，可以尽快读懂题意
    2.各个、每个；这类的题眼就是分组的依据
    3.分清数据源，然后就是筛选的关键词用在哪里，分清条件用在哪里、
    ```



## 5.连接/多表 查询

*   查询的字段来自于多个表

### 笛卡尔

*   卡尔矩阵积：表1  有m行   表2 有n行   ，结果有 m*n行
*   原因
    *   没有有效的连接条件
*   避免
    *   添加有效的连接条件
*   分类
    *   按照年代
        *   sq192标准    仅支持内连接,支持部分外连接(用于oracle\aqlserver,不适用mysql)
        *   sq199标准    推荐
    *   按照功能
        *   内连接 ： 等值连接	非等值连接	自连接
        *   外连接 ： 左外连接    右外连接        全外连接
        *   交叉连接

### sql192标准

```mysql
select 查询列表      #查询条件需要限定，因为此处在代码from后执行
from 表1 别名,表2 别名，...

where 有效的连接条件   #连接条件，就是当做桥梁连接两个表，多的见备注
[and 有效的连接条件]   #见备注
and 筛选条件
[group by 分组字段]
[having 分组后的筛选]
[order by 排序列表]

备注：
1.当连接的表超过三个的时候，连接条件超过三个，where只能连接两个，多的用and连接
2.多表最好先把各个表涉及的共同的字段列出来(好写连接条件)，然后把不相同的字段列出来
```

#### 等值连接

```mysql
有效连接为： where 表1.key = 表2.别名

多表连接

多表连接的结果为多表的交集部分
n 表连接，至少需要 n-1个连接条件，多个条件筛选，第一个用where,其余的用and
 多表的顺序无要求
一般需要非表起别名
可以搭配前面介绍的所有字句（排序，筛选，分组）
```

#### 非等值连接

```mysql
有效连接：	where 非等值的连接条件
```

#### 自连接

```mysql
有效连接
from 表1 别名1；表1 别名2   #就在一个表中
where 非等值的连接条件 
```

### sql199

```mysql
select 查询列表
from 表1 别名
连接类型 join 表2 别名  on   连接条件     #连接条件，就是当做桥梁连接两个表
连接类型 join 表3 别名  on   连接条件     #连接条件，就是当做桥梁连接两个表
...
[where 筛选条件]
[group by 分组条件]
[having 筛选条件]
[order by 排序类型]

连接类型：
内连接：inner(等值、非等值、自连接)
外连接：
		左连：left[outer]
		右连：right[outer]	
        全外：full[outer]
交叉连接：cross
```

#### 内连接

*   与192 是一样的
*   所谓的 内连接就是在连接两部分表的交集，表之间是要有链接的 

#### 外连接

```mysql

# 听的课有问题，再说

外连接的查询结果为主表中所有记录

    如果从表中有和它匹配的，则显示匹配的值

    如果从表中没有和它匹配的，则显示 null

    查询结果=主表所有的行，其中从表和它匹配的将显示匹配行，如果没有匹配的则显示null

    外连接查询结果=内连接结果+主表中有而从表没有的内容
```

*   应用
    *   一个查询一个表中有，另一个表中没有的记录
    *   左外和右外交换两个表的顺序，可以实现同样的效果
    *   一般用于查询除了交集部分的剩余的不匹配的行
    *   主表到子表数据的映射，如果没有与之映射的数据就用null填充，并集
    
*   分类

    *   左外连接

    *   右外连接

    *   全外连接

        ```mysql
        相互映射，没有的数据使用null填充，相当于合/并集
        查询的记录条数=主表和字表的并集部分，子表有的数据，主表没有也用null填充
        ```

        

    *    主要信息在哪个表，哪个就是主表

#### 交叉连接

```mysql
两个表没有顺序
select 查询列表
from 表1 别名
cross join 表2 别名；
```

## 6.子查询

### 介绍

* 出现在其他语句内部的select语句。子查询、内查询

    外部的语句可以是insert 、update、delete、select等

* 外面是select语句，内嵌套其他select语句的查询。主查询、外查询

### 分类

* 按照子查询出现的位置

    select	：仅支持标量子查询

    from 	：支持表子查询 

    where	和	having	：标量子查询，列子查询，行子查询

    exists	：表子查询

* 结果集的行列数不同

    标量子查询（结果集有一行一列）  :单行

    列子查询   （结果集有一列多行）：多行

    行子查询   （结果集有多行多列）

    表子查询   （结果集一般为多行多列）

* 只是记录语法格式，看之前已经有数据库基础了

### where 或 having后面

#### 1.特点

*   子查询放在小括号内、放在条件的右侧

*   操作符使用

    ```mysql
    # 标量子查询，一般搭配单行操作符使用
    	< > <= >= <>
    # 列子查询，一般搭配多行操作符使用
    	in any/some all
    ```

*   起始就是查询的嵌套，嵌套使用（）把子查询括起来

    ```mysql
    where  ()  and  ()  #多条件
    
    分组以后就可以使用 having  
    
    having  () and （）
    ```

#### 标量子查询

*   子查询优先于主查询

#### 列子查询

*   多行操作符

    | 操作符      | 含义                       | 取值   |
    | ----------- | -------------------------- | ------ |
    | in / not in | 等于列表中的任意一个       | 所有值 |
    | and / some  | 和子查询返回的某一个值比较 |        |
    | all         | 和子查询返回的所有值比较   |        |

    ```.
    a in （） #a 取括号中值的一个  
    ```

#### 行子查询

*   多个字段当成一个字段

```mysql
where (employees_id,salary)=(
	select min(employee_id),max(salary)
	from employees);
```



### select

```mysql
仅支持标量子查询
select d.*,(
	select count(*)
	from employees
	)
from departments d;
```

### from

```mysql
就是将子查询充当一张表，要求必须起别名
from () 别名；
```

### exists

```mysql
相关子查询
exists(完整的查询语句)    结果：1或0
可以用in代替

select department_name
from departments d
where exists(子查询)
先执行外查询，然后根据相关字段在where里面过滤
```

## 7. 分页查询

### 用途

*   现实的数据，一页显示不全，分页提交sql请求

### 特点

*   limit  语句放在查询语句的最后

### 语法

```mysql
limit 起始条件索引，要显示的条目个数（显示的行数），  
#索引从0开始，0可以省略不写
#要显示的页数page,每页显示的条目数size limit （page-1*size size
```

## 8. 联合查询

### 介绍

*   uinon 联合  合并：将多条查询语句的结果合并成一个结果
*   用于多个没有连接的表之间的查询，
    *   即：要查询的结果来自于多个表，且多个表没有直接的链接关系，单查询信息一致

### 语法

```mysql
select... #查询语句1
union
select... 查询语句2
union
select... 查询语句3
...
#其实就是将 or 的分句给拆开了
```

### 特点

*   要求多条查询的条数（列数）是一致的

*  要求多条查询的每一列的类型和顺序最好是一致的

*  就是所有语句的并集，除掉重复值。

    使用 union all可以包含重复项






































